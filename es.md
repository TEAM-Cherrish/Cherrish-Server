## 0. 핵심 정리

- **Target:** `시술명(Name)` 단일 필드 검색
- **Stack:** Elasticsearch (기본 Match + Fuzzy + 동의어)
- **Scope:** 영문/브랜드 검색 제외, 순수 한글 시술명 매칭 강화

## 1. 도입 이유 및 기대 효과

- UI 수정 없이 백엔드 로직 변경만으로 즉각적인 체감 성능 향상.
- LIKE의 한계 극복: `LIKE %검색어%`가 잡지 못하는 오타(울세라), 띄어쓰기(피코 토닝), 표기 차이(아이피엘) 해결
- 검색 범위 명확화: 시술명에만 집중하여 검색 결과의 연관성을 높이고 노이즈 제거.

## 2. 트레이드오프 (Trade-off)

| **구분** | **내용** |
| --- | --- |
| **장점 (Pros)** | • 오타/띄어쓰기 보정으로 검색 성공률 대폭 상승
• DB 스키마/UI 변경 없음 (즉시 도입 가능) |
| **단점 (Cons)** | • 인프라 리소스(ES) 추가 필요
• Fuzzy 과매칭 위험 (의도치 않은 결과 노출 가능성 → 튜닝 필요)
• 동의어 사전 관리 필요 (초기 세팅 필수) |

## 3. 세부 정책 설정

### (1) 동의어 사전 (Synonyms)

- **전략:** 널리 쓰이는 한글 표기 변형과 띄어쓰기 케이스만 등록
- **제외:** 영문명(Fraxel), 브랜드 등은 제외


    | **대표어** | **동의어** | **비고** |
    | --- | --- | --- |
    | **IPL** | 아이피엘 | 한글/영문 발음 차이 |
    | **MTS** | 엠티에스 | 한글/영문 발음 차이 |
    | **레이저토닝** | 토닝 | 줄임말 |
    | **점빼기** | 점제거 | 단어 차이 |
    | **여드름** | 압출 | 관련 용어 |
    | LDM | 물방울리프팅 | LDM 장비를 보통 물방울 리프팅이라고 부름 |
    | 리쥬란 | 연어주사 | 리쥬란의 주성분(PDRN) 때문에 연어주사로 통용 |
    | NCTF | 샤넬주사 | 정식 명칭은 NCTF지만 샤넬주사로 검색하는 경우가 많음 |
    | 윤곽주사 | 조각주사, 달걀주사 | 병원마다 이름이 제각각임 |

### (2) Fuzzy (오타 보정) 강도

- **원칙:** 짧은 단어는 오타 허용 금지, 긴 단어만 허용하여 과매칭 방지.
    - **1~2글자:** Fuzzy **OFF**
    - **3~5글자:** Edit Distance **1**
    - **6글자~:** Edit Distance **2**

## 4. LIKE vs ES 결과 비교

| **사용자 입력** | **LIKE (%keyword%)** | **ES (최종 적용안)** | **비고** |
| --- | --- | --- | --- |
| **프락셀** | ✅ | ✅ | 기본 매칭 |
| **프락셀레이저** | ❌ (공백 불일치) | ✅ | 토크나이저가 해결 |
| **프락세** (오타) | ❌ | ✅ | Fuzzy(거리 1) 적용 |
| **울세라** (오타) | ❌ | ✅ | Fuzzy or 동의어 |
| **아이피엘** | ❌ (DB가 'IPL'일 경우) | ✅ | 동의어 사전 처리 |
| **Fraxel** (영문) | ❌ | ❌ | 범위 제외 |

## 5. 구현 가이드

### 5.1 인덱스 설계

- 검색 대상은 오직 `name` 하나임. (카테고리, 다운타임 등은 필터링용이 아니면 인덱싱 제외하거나 `keyword` 타입으로만 저장)

```json
// Index Mapping (Conceptual)
{
  "mappings": {
    "properties": {
      "id": { "type": "long" },
      "name": { 
        "type": "text", 
        "analyzer": "nori_analyzer" // 한글 형태소 분석기 + 동의어 필터
      }
    }
  }
}
```

### 5.2 검색 로직

- **Query:** `match` query 사용 (Fuzzy 옵션 포함)
- **Target Field:** `name` only

### 5.3 데이터 동기화

- **초기:** DB 전체 Bulk Insert
- **갱신:** 시술명 변경이 드물다면, 배포 시점에 Re-indexing 스크립트 실행으로 충분.
